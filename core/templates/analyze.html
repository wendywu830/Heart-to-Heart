{% load static %}
<html>  
  <head>
    <title>Heart to Heart</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" integrity="sha384-SI27wrMjH3ZZ89r4o+fGIJtnzkAnFs3E4qz9DIYioCQ5l9Rd/7UAa8DHcaL8jkWt" crossorigin="anonymous">    
    <style>
    </style>
  </head>
  <body>
    <div class="container-fluid min-100 d-flex flex-column">
      <div style="margin: 2% 9%">
      <div class="row">
        <div class="col">
          <h1 class="text-danger">Analyze Risk for Heart Disease</h1>
        </div>
        <div class="col">
          <div style="float: right">
              <a href="/home"><button class="btn btn-light btn-sm">Home</button></a>
              <a href="/logout"><button class="btn btn-light btn-sm">Log out</button></a>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-8">
          <div class="card">
            <div class="card-body"  style="margin: 2%">
              <p>How are your health statistics looking today?</p>
              <form method="POST" action="/analyze">
                {% csrf_token %}
                <div class="form-group row">
                  <label>Age</label>
                  <div class="col-sm-2">
                    <input class="form-control" type="number" name="age" required>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Gender</label>
                  <div class="col-sm-4">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="sex" id="inlineRadio1" value="1">
                      <label class="form-check-label" for="inlineRadio1">Male</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="sex" id="inlineRadio2" value="0">
                      <label class="form-check-label" for="inlineRadio2">Female</label>
                    </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Chest pain type</label>
                  <div class="col-sm-4">
                  <select class="form-control" name="cpt">
                    <option value="1">Typical angina</option>
                    <option value="2">Atypical angina</option>
                    <option value="3">Non-anginal pain</option>
                    <option value="4">Asymptomatic</option>
                  </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Resting blood pressure</label>
                  <div class="col-sm-2">
                    <input class="form-control" type="number" name="restbps" required>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Cholesterol (mg/dl)</label>
                  <div class="col-sm-2">
                    <input class="form-control" type="number" name="chol" required>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Fasting blood sugar level (mg/dl)</label>
                  <div class="col-sm-6">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="fbs" id="inlineRadio1" value="0">
                    <label class="form-check-label" for="inlineRadio1"><= 120 mg/dl</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="fbs" id="inlineRadio2" value="1">
                    <label class="form-check-label" for="inlineRadio2">> 120 mg/dl</label>
                  </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Resting electrocardiographic measurement</label>
                  <div class="col-sm-5">
                  <select class="form-control" name="rest_ecg">
                    <option value="0">Normal</option>
                    <option value="1">ST-T abnormality</option>
                    <option value="2">Probable ventricular hypertrophy by Estes' criteria</option>
                  </select>
                  </div>
                </div>
                
                <div class="form-group row">
                  <label>Maximum heart rate achieved</label>
                  <div class="col-sm-2">
                    <input class="form-control" type="number" name="max_heart_rate">
                  </div>
                </div>
        
                <div class="form-group row">
                  <label>Exercise induced angina</label>
                  <div class="col-sm-4">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ex_ang" id="inlineRadio1" value="1">
                      <label class="form-check-label" for="inlineRadio1">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="ex_ang" id="inlineRadio2" value="0">
                      <label class="form-check-label" for="inlineRadio2">No</label>
                    </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Old peak</label>
                  <div class="col-sm-2">
                    <input class="form-control" type="number" step="0.01" name="oldpeak">
                  </div>
                </div>
                <div class="form-group row">
                  <label>Slope of the peak exercise ST segment</label>
                  <div class="col-sm-4">
                  <select class="form-control" name="slope">
                    <option value="1">Upsloping</option>
                    <option value="2">Flat</option>
                    <option value="3">Downsloping</option>
                  </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Number of major vessels (0-3) colored by flourosopy </label>
                  <div class="col-sm-2">
                  <select class="form-control" name="vessels">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label>Thal</label>
                  <div class="col-sm-2">
                  <select class="form-control" name="thal">
                    <option value="3">Normal</option>
                    <option value="6">Fixed defect</option>
                    <option value="7">Reversable defect</option>
                  </select>
                  </div>
                </div>
                <button type="submit" class="btn btn-danger">Calculate</button>
              </form>
            </div>
          </div>
        </div>
      
        <div class="col-sm-4">
          <div class="card">
            <div class="card body" style="margin: 2%; border: 0">
              {% if result != 2 %}
              <div>
                Based on our machine learning model, you are:
                <br>
                {% if result == 1 %}
                <b style="color: red; font-size: 35px">LIKELY</b>
                {% endif %}
                {% if result == 0 %}
                <b style="color: green; font-size: 35px"> NOT LIKELY</b> 
                {% endif %}
                <br>
                to develop heart disease.
                {% if result == 1 %}
                  <br><a href="/learn">Learn about ways to decrease your likelihood here</a>
                {% endif %}
              </div>
              {% else %}
                Fill out your most updated health info/statistics to get your result!
                <br>
              {% endif %}
              <br>
              <div>
                <h4>The algorithm: </h4>
                <b>KNN</b> - classifies based on <i>k</i> nearest neighbors
                <br>
                How is our <i>k</i> chosen? <br>
                <img src="{% static 'img/k_val.png' %}" width="255" height="170">
                <p>
                    We did specific analysis to find the best <i>k</i> value for accurate predictions of heart disease. 
                    Looking at how the error rates varied with different values, we chose the <i>k</i>  value with the 
                    lowest error rate, which as shown by the plot, seems to be the values of 11 and 13.
                </p>
              </div>
            </div>
         </div> 
      </div>
    </div>
    </div>
  </body>
</html>